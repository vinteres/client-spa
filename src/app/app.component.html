<div class="page-cont">
  <div *ngIf="isLoggedIn">
    <div class="header shadow-sm">
      <div class="content">
        <div class="home-data">
          <a routerLink="/" style="font-weight: bold; color: #000; font-size: 20px; padding: 5px 0; display: inline-block;">
            <img src="/assets/logo.png" style="height: 39px;" />
            <span class="align-middle badge badge-pill badge-primary beta-badge">Beta</span>
          </a>
        </div>
        <div class="user-data">
          <a *ngIf="isActiveUser" class="header-item" [routerLink]="['/user/' + loggedUser().id]">
            <fa-icon class="primary-item" [icon]="faProfile" title="{{ 'My profile' | translate }}"></fa-icon>
          </a>
          <a *ngIf="isActiveUser" class="header-item" routerLink="/chat" style="position: relative;" title="{{ 'Chat' | translate}}">
            <fa-icon class="primary-item" [icon]="faEnvelope"></fa-icon>
            <span *ngIf="notifsCount.msg > 0" class="badge rounded-pill bg-danger" style="top: 8px; right: -8px; color: #fff; font-size: 11px; font-family: initial; font-weight: 800; position: absolute;">{{notifsCount.msg}}</span>
          </a>
          <a *ngIf="isActiveUser" class="header-item" routerLink="/notifications" style="position: relative;" title="{{ 'Notifications' | translate }}">
            <fa-icon class="primary-item" [icon]="faBell"></fa-icon>
            <span *ngIf="notifsCount.notif > 0" class="badge rounded-pill bg-danger" style="top: 8px; right: -8px; color: #fff; font-size: 11px; font-family: initial; font-weight: 800; position: absolute;">{{notifsCount.notif}}</span>
          </a>
          <div class="btn-group">
            <a data-toggle="dropdown" class="header-item" style="width: 15px; cursor: pointer;">
              <fa-icon class="primary-item" [icon]="faEllipsisV"></fa-icon>
            </a>
            <div class="dropdown-menu" style="margin-top: -10px;">
              <a *ngIf="isActiveUser" class="dropdown-item" routerLink="/settings">
                <fa-icon [icon]="faSettings"></fa-icon>
                {{ 'Settings' | translate }}
              </a>
              <a class="dropdown-item" (click)="openFeedbackModal(feedbackDialog)">
                <fa-icon [icon]="faFeedback"></fa-icon>
                {{ 'Feedback' | translate }}
              </a>
              <a class="dropdown-item" (click)="logout()">
                <fa-icon [icon]="faLogout"></fa-icon>
                {{ 'Logout' | translate }}
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="isActiveUser" class="left-menu">
      <a routerLink="/likes" class="item">
        <fa-icon [icon]="faIntro"></fa-icon>
        {{ 'Likes' | translate }} <span *ngIf="notifsCount.intro > 0" class="badge rounded-pill bg-danger" style="top: 3px; color: #fff; font-size: 11px; font-family: initial; font-weight: 800; position: absolute;">{{notifsCount.intro}}</span>
      </a>
      <a routerLink="/find-people" class="item">
        <fa-icon [icon]="faFindPeople"></fa-icon>
        {{ 'Find people' | translate}}
      </a>
      <a routerLink="/matches" class="item">
        <fa-icon [icon]="faMatch"></fa-icon>
        {{ 'Matches' | translate }}
      </a>
      <a routerLink="/views" class="item">
        <fa-icon [icon]="faViews"></fa-icon>
        {{ 'Views' | translate }}
      </a>
      <a routerLink="/compatabilities" class="item">
        <fa-icon [icon]="faCompatability"></fa-icon>
        {{ 'Compatability' | translate }} <span *ngIf="compatabilityCount && 0 < compatabilityCount">({{compatabilityCount}})</span>
      </a>
    </div>
  </div>

  <div class="page-container">
    <div *ngIf="isActiveUser && showVerifyAlert" class="alert alert-warning" role="alert" style="position: relative;">
      <a href="javascript:void(0)" (click)="openVerifyModal()" style="color: #4798b5;">
        {{ 'Verify yourself' | translate }}
      </a> {{ 'and show that it is really you!' | translate }}
      <br>
      {{ 'Verified profiles are prioritised in searches and listings.' | translate }}
      <fa-icon [icon]="faClose" style="font-size: 25px; position: absolute; right: 5px; top: 5px;" (click)="hideVerifyAlert()"></fa-icon>
    </div>
    <router-outlet></router-outlet>
  </div>
</div>

<ng-template #feedbackDialog let-modal>
  <div class="modal-body">
    <div class="alert alert-secondary" role="alert">
      {{ 'If you have found a bug, hove some ideas to improve the app or just want to send general feedback - leave a message!' | translate }}
    </div>
    <div class="form-group">
      <label for="reason">{{ 'Type' | translate}}</label>
      <select id="reason" class="form-control" #feedbackType>
        <option value="bug">{{'Found a bug' | translate }}</option>
        <option value="feature">{{ 'New feature' | translate }}</option>
        <option value="other">{{ 'Other' | translate }}</option>
      </select>
    </div>

    <div class="form-group required">
      <label class="control-label" for="details">{{ 'Message' | translate }}</label>
      <textarea id="details" class="form-control" placeholder="{{ 'Give us more details..' | translate }}" [(ngModel)]='feedbackDetails'></textarea>
    </div>
    <button class="btn btn-outline-primary" (click)="sendFeedback(feedbackType.value)" [disabled]="!feedbackDetails || 0 === feedbackDetails.trim().length" style="width: 100%;">{{ 'Send' | translate }}</button>
    <button type="button" class="btn btn-outline-primary" style="width: 100%; margin-top: 10px;" data-dismiss="modal" aria-label="Close" (click)="modal.dismiss('Cross click')">
      {{ 'Close' | translate }}
    </button>
  </div>
</ng-template>

<ng-template #verifyDialog let-modal>
  <div class="modal-header">
    <h4 class="modal-title">{{ 'Verification Request' | translate }}</h4>
    <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div *ngIf="!verifying">
      <div style="font-weight: bold;">
        {{ 'Why should I verify my profile?' | translate }}
      </div>
      <ul style="padding-left: 20px;">
        <li>{{ 'You show people that it\'s really you' | translate }}</li>
        <li>{{ 'Your profile will be prioritised in searches and listings' | translate }}</li>
        <li>{{ 'When you\'re verified then ONLY other verified people can contact you' | translate }}</li>
      </ul>

      <div style="font-weight: bold;">
        {{ 'How does verification work?' | translate }}
      </div>
      {{ 'Take a photo (from your current device) with the target gesture and submit it. The verification photo will be compared to your profile picture' | translate }}

      <div *ngIf="!verificationStatus.profileImageId" class="alert alert-danger" role="alert" style="margin-top: 20px;">
        {{ 'You must upload a profile image before you request verification.' | translate }}
      </div>

      <div *ngIf="verificationStatus.profileImageId" style="margin-top: 20px;">
        <button class="btn btn-outline-primary" style="width: 100%;" (click)="verifying = true">{{ 'Start verification' | translate }}</button>
      </div>
    </div>
    <div *ngIf="verifying">
      <div class="row">
        <div class="col-md-6 col-sm-12">
          <div style="margin-bottom: 15px;">
            <div style="margin-bottom: 10px;">
              {{ 'Please take a photo with the following gesture:' | translate }}
            </div>
            <img src="/assets/verify_gesture.jpg" class="border" style="width: 100%;" />
          </div>
        </div>
        <div class="col-md-6 col-sm-12">
          <camera-image-capture (imageCaptured)="imageCaptured($event)" (captureStarted)="clearCapturedImage()"></camera-image-capture>
        </div>
      </div>
      <div *ngIf="hasVerificationBLob" style="text-align: center;">
        <button class="btn btn-outline-primary" style="padding: 10px 5px; width: 100%;" (click)="sendVerificationRequest()">{{ 'Send for verification' | translate }}</button>
      </div>
    </div>
  </div>
</ng-template>

<preferences-modal></preferences-modal>

<like-modal></like-modal>

<notifier-container></notifier-container>

<span class="change-lang">
  <select class="form-control" #select (change)="changeLanguage(select.value)" style="font-size: 13px; padding: 2px; background-color: transparent;">
    <option *ngFor="let language of supportedLanguage"
            [selected]="currentLang === language.code"
            [value]="language.code">
      {{ language.label + ' (' + language.code + ')' }}
    </option>
  </select>
</span>

<span class="created-by-text">Created by Velizar</span>
